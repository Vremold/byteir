name: ByteIR CI
trigger:
  change:
    types:
    - create
    - push
jobs:
  byteir_compiler_tests:
    name: byteir compiler CI
    runs-on:
      spec: m1.4xlarge
    image: hub.byted.org/arnold/byteir_cuda:main
    working-directory: byteir/byteir
    steps:
      - name: Run clang format check
        commands:
          - bash .codebase/pipelines/clang_format_check.sh
      - id: cache
        uses: actions/cache
        inputs:
            key: llvm-commit-v0
            paths:
              - ./llvm_build
            restore_keys: 
              - llvm-commit-v0
      - name: Build and Test ByteIR Libs
        commands:
          - bash .codebase/pipelines/build_and_lit_test.sh
